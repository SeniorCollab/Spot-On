<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instructional Pictures - Spot On</title>
  <!-- Orbitron Font & Bootstrap CSS -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Global Tron-inspired Styles */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      min-height: 100%;
      overflow-x: hidden;
      font-family: 'Orbitron', sans-serif;
      color: #00ffff;  /* Neon cyan */
      background-color: #000; /* Dark background */
    }
    /* Offcanvas Toggle (if you want to leave it in case of navigation) */
    #offcanvasToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
      background: none;
      border: none;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hamburger-icon {
      width: 30px;
      height: 22px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .hamburger-icon span {
      display: block;
      height: 4px;
      width: 100%;
      background-color: #00ffff;
      border-radius: 2px;
      box-shadow: 0 0 5px #00ffff;
    }
    /* Offcanvas Sidebar (optional, if you need navigation) */
    .offcanvas {
      background-color: rgba(0, 0, 0, 0.95);
      border-left: 2px solid #00ffff;
    }
    .offcanvas-header,
    .offcanvas-body,
    .offcanvas-title {
      color: #00ffff;
    }
    .offcanvas .nav-link {
      color: #00ffff;
      border-bottom: 1px solid rgba(0, 255, 255, 0.2);
      padding: 0.75rem 1rem;
    }
    .offcanvas .nav-link:hover,
    .offcanvas .nav-link.active {
      background-color: rgba(0, 31, 63, 0.5);
    }
    /* Logout Button Styling */
    .logout-btn {
      background-color: #ff3333;
      color: #000;
      border: none;
      padding: 0.75rem 1rem;
      width: 100%;
      border-radius: 5px;
      margin-top: 1rem;
      text-transform: uppercase;
    }
    /* Page Header */
    .page-header {
      background: rgba(0, 31, 63, 0.85);
      border: 1px solid #00ffff;
      box-shadow: 0 0 10px #00ffff;
      color: #00ffff;
      padding: 2rem;
      border-radius: 0.5rem;
      margin-bottom: 2rem;
      text-align: center;
    }
    .page-header h1 {
      font-size: 2.5rem;
      margin: 0;
      text-shadow: 0 0 5px #00ffff;
    }
    .page-header p {
      font-size: 1.2rem;
      margin: 0;
      text-shadow: 0 0 3px #00ffff;
    }
    /* Instructional Picture Card */
    .instruction-card {
      background: rgba(0, 31, 63, 0.85);
      border: 1px solid #00ffff;
      box-shadow: 0 0 10px #00ffff;
      border-radius: 0.75rem;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 1.5rem;
    }
    .instruction-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 15px #00ffff;
    }
    .instruction-card img {
      width: 100%;
      height: auto;
      object-fit: cover;
      border-bottom: 1px solid #00ffff;
    }
    .instruction-card .card-body {
      padding: 1rem;
    }
    .instruction-title {
      font-weight: 600;
      font-size: 1.3rem;
      color: #00ffff;
      text-shadow: 0 0 5px #00ffff;
    }
    .instruction-text {
      color: #66ffff;
      text-shadow: 0 0 3px #00ffff;
      margin-top: 0.5rem;
    }
    /* Container Adjustments */
    .container {
      padding-top: 80px;
      padding-bottom: 2rem;
    }

    /* Mobile-Specific Adjustments */
    @media (max-width: 576px) {
      /* Offcanvas Toggle Adjustments */
      #offcanvasToggle {
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
      }
      /* Hamburger Icon becomes thicker on mobile */
      .hamburger-icon {
        width: 30px;
        height: 30px; /* Increased overall height */
        flex-direction: column;
        justify-content: space-between;
      }
      .hamburger-icon span {
        height: 8px; /* Increased bar thickness */
        width: 100%;
        background-color: #00ffff;
        border-radius: 2px;
        box-shadow: 0 0 5px #00ffff;
      }
      /* Adjust container padding for small devices */
      .container {
        padding-top: 60px;
        padding-bottom: 1.5rem;
      }
    }
    @media (max-width: 768px) {
      /* For tablets, Bootstrap grid classes handle column adjustments */
    @media (min-width: 0px) {
      .col-md-4,
      .col-sm-6,
      .col-lg-4 {
        flex: 0 0 100% !important;
        max-width: 100% !important;
  }
}
    }
  </style>
</head>
<body>

  <!-- Optional Offcanvas Toggle (for navigation) -->
  <button class="hamburger-btn" type="button" id="offcanvasToggle" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar">
    <div class="hamburger-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>

  <!-- Offcanvas Navigation -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Pinfinity</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <nav class="navbar">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="activity.html">View the Pin</a></li>
          <li class="nav-item"><a class="nav-link" href="shop.html">Store</a></li>
          <li class="nav-item"><a class="nav-link" href="guide.html">Instructions</a></li>
        </ul>
      </nav>
      <p class="mt-3">Instructional Pictures for Your Journey</p>
      <!-- Added Logout Button -->
      <button class="logout-btn" id="logoutBtn">Log Out</button>
    </div>
  </div>

  <!-- Page Header -->
  <div class="container">
    <div class="page-header">
      <h1 class="display-5">Instructional Pictures</h1>
      <p class="lead">Follow these steps visually to master the process.</p>
    </div>

    <!-- Instructional Pictures Gallery -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <!-- Example Picture 1 -->
      <!-- Step 1 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step1.jpg" alt="Step 1">
    <div class="card-body">
      <div class="instruction-title">Step 1</div>
      <div class="instruction-text">
        Go to the homepage and click "Sign Up" to create an account, or "User" to log in if you already have an account.
      </div>
    </div>
  </div>
</div>

<!-- Step 2 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step2.jpg" alt="Step 2">
    <div class="card-body">
      <div class="instruction-title">Step 2</div>
      <div class="instruction-text">
        After logging in, you will be redirected to our Instructions page. Click the hamburger icon on the top right, then "Home" to explore the globe. View details by clicking on the pins.
      </div>
    </div>
  </div>
</div>

<!-- Step 3 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step3.jpg" alt="Step 3">
    <div class="card-body">
      <div class="instruction-title">Step 3</div>
      <div class="instruction-text">
        To create your own pin, double click anywhere on the globe. Select your pin type.
      </div>
    </div>
  </div>
</div>

<!-- Step 4 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step4.jpg" alt="Step 4">
    <div class="card-body">
      <div class="instruction-title">Step 4</div>
      <div class="instruction-text">
        Enter the required information for your pin. Latitude and Longitude are automatically filled based on where you clicked on the globe.
      </div>
    </div>
  </div>
</div>

<!-- Step 5 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step5.jpg" alt="Step 5">
    <div class="card-body">
      <div class="instruction-title">Step 5</div>
      <div class="instruction-text">
       Click on the hamburger icon on the top right. To see posted pins, click on "View the Pin." Here, you can choose to see all pins posted by all users or your own.
      </div>
    </div>
  </div>
</div>

<!-- Step 6 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step6.jpg" alt="Step 6">
    <div class="card-body">
      <div class="instruction-title">Step 6</div>
      <div class="instruction-text">
       Need to edit or delete your pin? Locate your pin on the globe and click on it. Click on either edit or delete. This can also be done on the "View the Pin" page. You may only edit and delete your own pins.
      </div>
    </div>
  </div>
</div>

<!-- Step 7 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step7.jpg" alt="Step 7">
    <div class="card-body">
      <div class="instruction-title">Step 7</div>
      <div class="instruction-text">
      From the home page, you are also able to adjust the globe to show only your pins or all user pins. Click the hamburger icon, then click show my pins only or  show all pins.      </div>
    </div>
  </div>
</div>


<!-- Step 8 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step8.jpg" alt="Step 8">
    <div class="card-body">
      <div class="instruction-title">Step 8</div>
      <div class="instruction-text">
        To see shop items, click the hamburger icon and click on "Store." Here, you are able to see all shop pins posted by any user or your own shop pins.
      </div>
    </div>
  </div>
</div>


<!-- Step 9 -->
<div class="col">
  <div class="instruction-card">
    <img src="../step9.jpg" alt="Step 9">
    <div class="card-body">
      <div class="instruction-title">Step 9</div>
      <div class="instruction-text">
        Pinfinity also offers an AI chatbot! On the home screen, click on the chat bubble on the bottom right of the screen. Users can ask the chatbot questions regarding pins.
      </div>
    </div>
  </div>
</div>


  <!-- Firebase SDK & Logout Logic -->
  <script type="module">
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    // Initialize Firebase Auth (ensure your Firebase app is already initialized elsewhere if needed)
    const auth = getAuth();
    
    document.getElementById("logoutBtn").addEventListener("click", () => {
      signOut(auth)
        .then(() => {
          window.location.href = "../index.html"; // Adjust the redirection as needed
        })
        .catch(err => {
          console.error("Sign-out error:", err);
          alert("Could not sign out. See console for details.");
        });
    });
  </script>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
       <!-- Gemini Chat Widget -->
<div id="gemini-chat-widget">
  <div id="chat-toggle"> üí¨ Have questions? Click me! </div>
  <div id="chat-box">
    <div id="chat-messages"></div>
    <input type="text" id="chat-input" placeholder="Ask me anything..." />
  </div>
</div>

<style>
  /* Overall widget container */
  #gemini-chat-widget{
    position:fixed;
    bottom:20px;
    right:20px;
    font-family:'Orbitron',sans-serif;  /* Tron font */
    z-index:9999;
  }

  /* Floating toggle button */
  #chat-toggle {
    /* same width as #chat-box for a cleaner look */
    width: 320px;
    max-width: 100%;
    padding: 10px 0;
    border-radius: 12px;
  
    /* trim the glow so it‚Äôs less intrusive */
    box-shadow: 0 0 8px #00ffff, 0 0 12px #00ffff;
  }
  
  /* optional: keep the label on one line and prevent big ovals */
  #chat-toggle span,
  #chat-toggle {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Chat container */
  #chat-box{
    display:none;                     /* toggled in JS */
    flex-direction:column;
    width:320px;
    height:430px;
    background:rgba(0,31,63,.95);     /* deep Tron blue */
    color:#00ffff;
    border:2px solid #00ffff;
    border-radius:14px;
    box-shadow:0 0 12px #00ffff;
    overflow:hidden;
    backdrop-filter:blur(4px);
  }

  /* Messages area */
  #chat-messages{
    flex:1;
    padding:12px;
    overflow-y:auto;
    scrollbar-width:thin;
    scrollbar-color:#00ffff transparent;
  }
  #chat-messages::-webkit-scrollbar{
    width:6px;
  }
  #chat-messages::-webkit-scrollbar-thumb{
    background:#00ffff;
    border-radius:3px;
  }

  /* Input field */
  #chat-input{
    border:none;
    border-top:1px solid rgba(0,255,255,.4);
    background:rgba(0,0,0,.3);
    color:#00ffff;
    padding:12px;
    width:100%;
    box-sizing:border-box;
    outline:none;
  }
  #chat-input::placeholder{
    color:rgba(0,255,255,.6);
  }
</style>

<script type="module">
  import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";

  // Firebase init
  const firebaseConfig = {
    apiKey: "AIzaSyADk7if-797jFI3Y3IUCnCXFSlOsFmX_3k",
    authDomain: "spoton-cit481.firebaseapp.com",
    databaseURL: "https://spoton-cit481-default-rtdb.firebaseio.com",
    projectId: "spoton-cit481",
    storageBucket: "spoton-cit481.appspot.com",
    messagingSenderId: "753873898041",
    appId: "1:753873898041:web:bde5e8f86aea63b175dbe8"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const chatToggle = document.getElementById('chat-toggle');
  const chatBox = document.getElementById('chat-box');
  const chatMessages = document.getElementById('chat-messages');
  const chatInput = document.getElementById('chat-input');

  async function reverseGeocode(lat, lng) {
    const apiKey = "75204efa0be04a04b8acbd2fdf957fbf";
    const url = `https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lng}&key=${apiKey}&no_annotations=1&language=en`;

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error("API error");
      const data = await res.json();
      const comp = data.results[0]?.components;
      const city = comp?.city || comp?.town || comp?.village || "";
      const country = comp?.country || "";
      return `${city ? city + ', ' : ''}${country}`.trim();
    } catch (err) {
      console.warn("üåç Reverse geocoding failed:", err);
      return `(${lat}, ${lng})`;
    }
  }

  async function startChat() {
    const genAI = new GoogleGenerativeAI("AIzaSyBUaJbXwVgZpOpy0sr7HmCE38OAozsu5pc");
    const model = await genAI.getGenerativeModel({ model: "models/gemini-1.5-pro" });

    chatToggle.addEventListener('click', () => {
      chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
    });

    chatInput.addEventListener('keypress', async (e) => {
      if (e.key === 'Enter' && chatInput.value.trim() !== '') {
        const userMsg = chatInput.value;
        appendMessage('user', userMsg);
        chatInput.value = '';

        const pinData = await fetchPins();
        const pinsSummary = await Promise.all(
          pinData.map(async (p) => {
            const location = await reverseGeocode(p.lat, p.lng);
            return `${p.title} in ${location}: ${p.description}`;
          })
        );

        const prompt = `Here are some pins:\n${pinsSummary.join("\n")}\n\n${userMsg}`;

        try {
          const result = await model.generateContent(prompt);
          const response = result.response.text();
          appendMessage('bot', response);
        } catch (err) {
          appendMessage('bot', '‚ö†Ô∏è Sorry, something went wrong.');
          console.error(err);
        }
      }
    });

    function appendMessage(sender, text) {
      const msg = document.createElement('div');
      msg.textContent = (sender === 'user' ? 'üßë ' : 'ü§ñ ') + text;
      chatMessages.appendChild(msg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function fetchPins() {
      const snapshot = await get(ref(db, 'pins'));
      const data = snapshot.val();
      if (!data) return [];

      const pins = [];
      for (const userData of Object.values(data)) {
        for (const type of ['eventPins', 'moodPins', 'shopPins']) {
          const group = userData[type];
          if (!group) continue;
          for (const pin of Object.values(group)) {
            pins.push({
              title: pin.title || 'Untitled',
              description: pin.description || '',
              lat: pin.geolocation?.lat || 0,
              lng: pin.geolocation?.lng || 0
            });
          }
        }
      }
      return pins;
    }
  }

  startChat();
</script>

</body>
</html>


